/*
 * jQuery.weekCalendar v2.0-dev
 *
 * for support join us at the google group:
 *    - http://groups.google.com/group/jquery-week-calendar
 * have a look to the wiki for documentation:
 *    - http://wiki.github.com/themouette/jquery-week-calendar/
 * something went bad ? report an issue:
 *    - http://github.com/themouette/jquery-week-calendar/issues
 * get the last version on github:
 *    - http://github.com/themouette/jquery-week-calendar
 *
 * Copyright (c) 2009 Rob Monie
 * Copyright (c) 2010 Julien MUETTON
 * Dual licensed under the MIT and GPL licenses:
 *    http://www.opensource.org/licenses/mit-license.php
 *    http://www.gnu.org/licenses/gpl.html
 *
 * If you're after a monthly calendar plugin, check out this one :
 * http://arshaw.com/fullcalendar/
 */
(function(a){var b=a.fn.jquery.split("."),c=10*b[0]+b[1]<15;a.widget("ui.weekCalendar",function(){var b;return{options:{date:new Date,timeFormat:null,dateFormat:"M d, Y",alwaysDisplayTimeMinutes:!0,use24Hour:!1,daysToShow:7,minBodyHeight:100,firstDayOfWeek:function(b){return a(b).weekCalendar("option","daysToShow")!=5?0:1},useShortDayNames:!1,timeSeparator:" to ",startParam:"start",endParam:"end",businessHours:{start:8,end:18,limitDisplay:!1},newEventText:"New Event",timeslotHeight:20,defaultEventLength:2,timeslotsPerHour:4,minDate:null,maxDate:null,buttons:!0,buttonText:{today:"today",lastWeek:"previous",nextWeek:"next"},switchDisplay:{},scrollToHourMillis:500,allowEventDelete:!1,allowCalEventOverlap:!1,overlapEventsSeparate:!1,totalEventsWidthPercentInOneColumn:100,readonly:!1,allowEventCreation:!0,deletable:function(a,b){return!0},draggable:function(a,b){return!0},resizable:function(a,b){return!0},eventClick:function(a,b,c,d,e){},eventRender:function(a,b){return b},eventAfterRender:function(a,b){return b},eventRefresh:function(a,b){return b},eventDrag:function(a,b){},eventDrop:function(a,b){},eventResize:function(a,b){},eventNew:function(a,b,c,d,e){},eventMouseover:function(a,b){},eventMouseout:function(a,b){},eventDelete:function(a,b,c,d,e){d.weekCalendar("removeEvent",a.id)},calendarBeforeLoad:function(a){},calendarAfterLoad:function(a){},noEvents:function(){},eventHeader:function(a,b){return a.entry_type},eventBody:function(a,b){return a.description},shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],longMonths:["January","February","March","April","May","June","July","August","September","October","November","December"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],longDays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],users:[],showAsSeparateUsers:!0,getUserId:function(a,b,c){return b},getUserName:function(a,b,c){return a},getEventUserId:function(a,b){return a.userId},setEventUserId:function(a,b,c){return b.userId=a,b},displayFreeBusys:!1,getFreeBusyUserId:function(a,b){return a.userId},defaultFreeBusy:{free:!1},freeBusyRender:function(a,b,c){return a.free?b.addClass("free-busy-free"):b.addClass("free-busy-busy"),b},startOnFirstDayOfWeek:function(b){return a(b).weekCalendar("option","daysToShow")>=5},displayOddEven:!1,textSize:13,title:"%start% - %end%",jsonOptions:{},headerSeparator:"<br />",getHeaderDate:null,preventDragOnEventCreation:!1,resizeEvent:"resize.weekcalendar"},_create:function(){var b=this;b._computeOptions(),b._setupEventDelegation(),b._renderCalendar(),b._loadCalEvents(),b._resizeCalendar(),b._scrollToHour(b.options.date.getHours(),!0),this.options.resizeEvent&&(a(window).unbind(this.options.resizeEvent),a(window).bind(this.options.resizeEvent,function(){b._resizeCalendar()}))},refresh:function(){this._loadCalEvents(this.element.data("startDate"))},clear:function(){this._clearCalendar()},today:function(){this._clearCalendar(),this._loadCalEvents(new Date)},prevWeek:function(){var a=new Date(this.element.data("startDate").getTime()-f/6);this._clearCalendar(),this._loadCalEvents(a)},nextWeek:function(){var a=new Date(this.element.data("startDate").getTime()+f+e);this._clearCalendar(),this._loadCalEvents(a)},gotoWeek:function(a){this._clearCalendar(),this._loadCalEvents(a)},gotoDate:function(a){this._clearCalendar(),this._loadCalEvents(a)},setDaysToShow:function(b){var c=this,d=c._getCurrentScrollHour();c.options.daysToShow=b,a(c.element).html(""),c._renderCalendar(),c._loadCalEvents(),c._resizeCalendar(),c._scrollToHour(d,!1),this.options.resizeEvent&&(a(window).unbind(this.options.resizeEvent),a(window).bind(this.options.resizeEvent,function(){c._resizeCalendar()}))},removeEvent:function(b){var c=this;c.element.find(".wc-cal-event").each(function(){if(a(this).data("calEvent").id===b)return a(this).remove(),!1}),c.element.find(".wc-day-column-inner").each(function(){c._adjustOverlappingEvents(a(this))}),c._removeEventInData(calEvent)},removeUnsavedEvents:function(){var b=this;b.element.find(".wc-new-cal-event").each(function(){a(this).remove()}),b.element.find(".wc-day-column-inner").each(function(){b._adjustOverlappingEvents(a(this))})},updateEvent:function(a){this._updateEventInData(a),this._updateEventInCalendar(a)},getTimeslotTimes:function(a){var b=this.options,c=b.businessHours.limitDisplay?b.businessHours.start_time:0,d=new Date(a.getFullYear(),a.getMonth(),a.getDate(),c),e=[],f=d.getTime();for(var g=0;g<b.timeslotsPerDay;g++){var h=f+b.millisPerTimeslot;e[g]={start:new Date(f),startFormatted:this.formatTime(new Date(f),b.timeFormat),end:new Date(h),endFormatted:this.formatTime(new Date(h),b.timeFormat)},f=h}return e},formatDate:function(a,b){return b?this._formatDate(a,b):this._formatDate(a,this.options.dateFormat)},formatTime:function(a,b){return b?this._formatDate(a,b):this.options.timeFormat?this._formatDate(a,this.options.timeFormat):this.options.use24Hour?this._formatDate(a,"H:i"):this._formatDate(a,"h:i a")},serializeEvents:function(){var b=this,c=[];return b.element.find(".wc-cal-event").each(function(){c.push(a(this).data("calEvent"))}),c},serializeAllEvents:function(){return this.options.data},next:function(){if(this._startOnFirstDayOfWeek())return this.nextWeek();var a=new Date(this.element.data("startDate").getTime());a.setDate(a.getDate()+this.options.daysToShow),this._clearCalendar(),this._loadCalEvents(a)},prev:function(){if(this._startOnFirstDayOfWeek())return this.prevWeek();var a=new Date(this.element.data("startDate").getTime());a.setDate(a.getDate()-this.options.daysToShow),this._clearCalendar(),this._loadCalEvents(a)},getCurrentFirstDay:function(){return this._dateFirstDayOfWeek(this.options.date||new Date)},getCurrentLastDay:function(){return this._addDays(this.getCurrentFirstDay(),this.options.daysToShow-1)},_updateEventInData:function(b){options=this.options,newEvent=!0,a.each(options.data,function(a,c){c.id===b.id&&(c=b,newEvent=!1)}),newEvent&&options.data.push(b)},_removeEventInData:function(a){options=this.options;for(i=0;i<options.data.length;i++)if(options.data[i].id===a.id){options.data.splice(i,1);break}},_setOption:function(b,c){var d=this;if(d.options[b]!=c){if(b=="beforeEventNew"){d.options[b]=c;return}var e=a.map(d.element.find(".wc-cal-event"),function(){return a(this).data("calEvent")}),f={};f[b]=c,d._renderEvents({events:e,options:f},d.element.find(".wc-day-column-inner"))}},_computeOptions:function(){var a=this.options;a.businessHours.limitDisplay?(a.timeslotsPerDay=a.timeslotsPerHour*(a.businessHours.end_time-a.businessHours.start_time),a.millisToDisplay=(a.businessHours.end_time-a.businessHours.start_time)*36e5,a.millisPerTimeslot=a.millisToDisplay/a.timeslotsPerDay):(a.timeslotsPerDay=a.timeslotsPerHour*24,a.millisToDisplay=e,a.millisPerTimeslot=e/a.timeslotsPerDay)},_resizeCalendar:function(){var b=this.options;if(b&&a.isFunction(b.height)){var c=b.height(this.element),d=this.element.find(".wc-header").outerHeight(),e=this.element.find(".wc-toolbar").outerHeight(),f=Math.max(c-e-d,b.minBodyHeight),g=this.element.find(".wc-time-slots").outerHeight();this.element.find(".wc-scrollable-grid").height(f),g<=f?this.element.find(".wc-scrollbar-shim").width(0):this.element.find(".wc-scrollbar-shim").width(this._findScrollBarWidth()),this._trigger("resize",this.element)}},_findScrollBarWidth:function(){var b=a('<div style="width:50px;height:50px;overflow:auto"><div/></div>').appendTo("body"),c=b.children(),d=c.innerWidth()-c.height(99).innerWidth();return b.remove(),d||16},_setupEventDelegation:function(){var b=this,c=this.options;this.element.click(function(d){var e=a(d.target),f;if(e.data("preventClick"))return;var g=e.hasClass("wc-cal-event")?e:e.parents(".wc-cal-event");g.length&&(f=b.getFreeBusyManagerForEvent(g.data("calEvent")),c.allowEventDelete&&e.hasClass("wc-cal-event-delete")?c.eventDelete(g.data("calEvent"),g,f,b.element,d):c.eventClick(g.data("calEvent"),g,f,b.element,d))}).mouseover(function(d){var e=a(d.target);if(b._isDraggingOrResizing(e))return;e.hasClass("wc-cal-event")&&c.eventMouseover(e.data("calEvent"),e,d)}).mouseout(function(d){var e=a(d.target);if(b._isDraggingOrResizing(e))return;if(e.hasClass("wc-cal-event")){if(e.data("sizing"))return;c.eventMouseout(e.data("calEvent"),e,d)}})},_isDraggingOrResizing:function(a){return a.hasClass("ui-draggable-dragging")||a.hasClass("ui-resizable-resizing")},_renderCalendar:function(){var b,c,d=this,e=this.options;b=a('<div class="ui-widget wc-container">').appendTo(d.element),d._renderCalendarButtons(b),d._renderCalendarHeader(b),d._renderCalendarBody(b),c=b.find(".wc-day-column-inner"),c.each(function(b,c){e.readonly||(d._addDroppableToWeekDay(a(this)),e.allowEventCreation&&d._setupEventCreationForWeekDay(a(this)))})},_renderCalendarButtons:function(b){var c=this,d=this.options;if(d.buttons){var e="";e+='<div class="ui-widget-header wc-toolbar">',e+='<div class="wc-display"></div>',e+='<div class="wc-nav">',e+='<button class="wc-prev">'+d.buttonText.lastWeek+"</button>",e+='<button class="wc-today">'+d.buttonText.today+"</button>",e+='<button class="wc-next">'+d.buttonText.nextWeek+"</button>",e+="</div>",e+='<h1 class="wc-title"></h1>',e+="</div>",a(e).appendTo(b),b.find(".wc-nav .wc-today").button({icons:{primary:"ui-icon-home"}}).click(function(){return c.today(),!1}),b.find(".wc-nav .wc-prev").button({text:!1,icons:{primary:"ui-icon-seek-prev"}}).click(function(){return c.element.weekCalendar("prev"),!1}),b.find(".wc-nav .wc-next").button({text:!1,icons:{primary:"ui-icon-seek-next"}}).click(function(){return c.element.weekCalendar("next"),!1});if(this.options.switchDisplay&&a.isPlainObject(this.options.switchDisplay)){var f=b.find(".wc-display");a.each(this.options.switchDisplay,function(b,d){var e="wc-switch-display-"+d,g=a('<input type="radio" id="'+e+'" name="wc-switch-display" class="wc-switch-display"/>'),h=a('<label for="'+e+'"></label>');h.html(b),g.val(d),parseInt(c.options.daysToShow,10)===parseInt(d,10)&&g.attr("checked","checked"),f.append(g).append(h)}),f.find("input").change(function(){c.setDaysToShow(parseInt(a(this).val(),10))})}b.find(".wc-nav, .wc-display").buttonset();var g=b.find(".wc-nav").outerHeight();b.find(".wc-title").height(g).css("line-height",g+"px")}else{var e="";e+='<div class="ui-widget-header wc-toolbar">',e+='<h1 class="wc-title"></h1>',e+="</div>",a(e).appendTo(b)}},_renderCalendarHeader:function(b){var c=this,d=this.options,e=d.showAsSeparateUsers&&d.users&&d.users.length,f="",g="",h;e&&(f=' rowspan="2"',g=' colspan="'+d.users.length+'" '),h='<div class="ui-widget-content wc-header">',h+='<table><tbody><tr><td class="wc-time-column-header"></td>';for(var i=1;i<=d.daysToShow;i++)h+='<td class="wc-day-column-header wc-day-'+i+'"'+g+"></td>";h+='<td class="wc-scrollbar-shim"'+f+"></td></tr>";if(e){h+='<tr><td class="wc-time-column-header"></td>';var j=d.users.length,k="";for(var i=1;i<=d.daysToShow;i++)for(var l=0;l<j;l++)k=[],l==0&&k.push("wc-day-column-first"),l==j-1&&k.push("wc-day-column-last"),k.length?k=k.join(" "):k="wc-day-column-middle",h+='<td class="'+k+" wc-user-header wc-day-"+i+" wc-user-"+c._getUserIdFromIndex(l)+'">',h+=c._getUserName(l),h+="</td>";h+="</tr>"}h+="</tbody></table></div>",a(h).appendTo(b)},_renderCalendarBody:function(b){var c=this,d=this.options,e=d.showAsSeparateUsers&&d.users&&d.users.length,f,g;f='<div class="wc-scrollable-grid">',f+='<table class="wc-time-slots">',f+="<tbody>",f+="</tbody>",f+="</table>",f+="</div>",f=a(f),g=f.find("tbody"),c._renderCalendarBodyTimeSlots(g),c._renderCalendarBodyOddEven(g),c._renderCalendarBodyFreeBusy(g),c._renderCalendarBodyEvents(g),f.appendTo(b),b.find(".wc-full-height-column").height(d.timeslotHeight*d.timeslotsPerDay),b.find(".wc-time-slot").height(d.timeslotHeight-1),b.find(".wc-time-header-cell").css({height:d.timeslotHeight*d.timeslotsPerHour-11,padding:5});if(e)for(var h=0,i=d.users.length;h<i;h++)b.find(".wc-user-"+c._getUserIdFromIndex(h)).data("wcUser",d.users[h]).data("wcUserIndex",h).data("wcUserId",c._getUserIdFromIndex(h))},_renderCalendarBodyTimeSlots:function(b){var c=this.options,d,e,f,g=c.showAsSeparateUsers&&c.users&&c.users.length,h=c.businessHours.limitDisplay?c.businessHours.start_time:0,i=c.businessHours.limitDisplay?c.businessHours.end_time:24,j=1;c.displayOddEven&&(j+=1),c.displayFreeBusys&&(j+=1),j>1?j=' rowspan="'+j+'"':j="",d='<tr class="wc-grid-row-timeslot">',d+='<td class="wc-grid-timeslot-header"'+j+"></td>",d+='<td colspan="'+c.daysToShow*(g?c.users.length:1)+'">',d+='<div class="wc-no-height-wrapper wc-time-slot-wrapper">',d+='<div class="wc-time-slots">';for(e=h;e<i;e++){for(f=0;f<c.timeslotsPerHour-1;f++)d+='<div class="wc-time-slot"></div>';d+='<div class="wc-time-slot wc-hour-end"></div>'}d+="</div>",d+="</div>",d+="</td>",d+="</tr>",a(d).appendTo(b)},_renderCalendarBodyOddEven:function(b){if(this.options.displayOddEven){var c=this.options,d='<tr class="wc-grid-row-oddeven">',e=c.showAsSeparateUsers&&c.users&&c.users.length,f,g={odd:"wc-column-odd",even:"ui-state-hover wc-column-even"};for(var h=1;h<=c.daysToShow;h++)if(!e)f=f=="odd"?"even":"odd",d+='<td class="wc-day-column day-'+h+'">',d+='<div class="wc-no-height-wrapper wc-oddeven-wrapper">',d+='<div class="wc-full-height-column '+g[f]+'"></div>',d+="</div>",d+="</td>";else{var i=c.users.length;for(var j=0;j<i;j++)f=f=="odd"?"even":"odd",d+='<td class="wc-day-column day-'+h+'">',d+='<div class="wc-no-height-wrapper wc-oddeven-wrapper">',d+='<div class="wc-full-height-column '+g[f]+'" ></div>',d+="</div>",d+="</td>"}d+="</tr>",a(d).appendTo(b)}},_renderCalendarBodyFreeBusy:function(b){if(this.options.displayFreeBusys){var c=this,d=this.options,e='<tr class="wc-grid-row-freebusy">',f=d.showAsSeparateUsers&&d.users&&d.users.length;e+="</td>";for(var g=1;g<=d.daysToShow;g++)if(d.displayFreeBusys)if(!f)e+='<td class="wc-day-column day-'+g+'">',e+='<div class="wc-no-height-wrapper wc-freebusy-wrapper">',e+='<div class="wc-full-height-column wc-column-freebusy wc-day-'+g+'"></div>',e+="</div>",e+="</td>";else{var h=d.users.length;for(var i=0;i<h;i++)e+='<td class="wc-day-column day-'+g+'">',e+='<div class="wc-no-height-wrapper wc-freebusy-wrapper">',e+='<div class="wc-full-height-column wc-column-freebusy wc-day-'+g,e+=" wc-user-"+c._getUserIdFromIndex(i)+'">',e+="</div>",e+="</div>",e+="</td>"}e+="</tr>",a(e).appendTo(b)}},_renderCalendarBodyEvents:function(b){var c=this,d=this.options,e,f=d.showAsSeparateUsers&&d.users&&d.users.length,g=d.businessHours.limitDisplay?d.businessHours.start_time:0,h=d.businessHours.limitDisplay?d.businessHours.end_time:24;e='<tr class="wc-grid-row-events">',e+='<td class="wc-grid-timeslot-header">';for(var i=g;i<h;i++){var j=d.businessHours.start_time<=i&&d.businessHours.end_time>i?"ui-state-active wc-business-hours":"ui-state-default";e+='<div class="wc-hour-header '+j+'">',d.use24Hour?e+='<div class="wc-time-header-cell">'+c._24HourForIndex(i)+"</div>":e+='<div class="wc-time-header-cell">'+c._hourForIndex(i)+'<span class="wc-am-pm">'+c._amOrPm(i)+"</span></div>",e+="</div>"}e+="</td>";var k="ui-state-default wc-day-column";for(var i=1;i<=d.daysToShow;i++)if(!f)e+='<td class="'+k+" wc-day-column-first wc-day-column-last day-"+i+'">',e+='<div class="wc-full-height-column wc-day-column-inner day-'+i+'"></div>',e+="</td>";else{var l=d.users.length,m;for(var n=0;n<l;n++)m=[],n==0&&m.push("wc-day-column-first"),n==l-1&&m.push("wc-day-column-last"),m.length?m=m.join(" "):m="wc-day-column-middle",e+='<td class="'+k+" "+m+" day-"+i+'">',e+='<div class="wc-full-height-column wc-day-column-inner day-'+i,e+=" wc-user-"+c._getUserIdFromIndex(n)+'">',e+="</div>",e+="</td>"}e+="</tr>",a(e).appendTo(b)},_setupEventCreationForWeekDay:function(b){var c=this,d=this.options;b.mousedown(function(b){var c=a(b.target);if(c.hasClass("wc-day-column-inner")){var e=a('<div class="wc-cal-event wc-new-cal-event wc-new-cal-event-creating"></div>');e.css({lineHeight:d.timeslotHeight-2+"px",fontSize:d.timeslotHeight/2+"px"}),c.append(e);var f=c.offset().top,g=b.pageY-f,h=(g-g%d.timeslotHeight)/d.timeslotHeight,i=h*d.timeslotHeight;e.css({top:i}),d.preventDragOnEventCreation||c.bind("mousemove.newevent",function(a){e.show(),e.addClass("ui-resizable-resizing");var b=Math.round(a.pageY-f-i),c=b%d.timeslotHeight;if(c<0){var g=b-c;e.css("height",g<d.timeslotHeight?d.timeslotHeight:g)}else e.css("height",b+(d.timeslotHeight-c))}).mouseup(function(){c.unbind("mousemove.newevent"),e.addClass("ui-corner-all")})}}).mouseup(function(b){var e=a(b.target),f=e.closest(".wc-day-column-inner"),g=f.find(".wc-new-cal-event-creating");if(g.length){var h=!g.hasClass("ui-resizable-resizing");h&&g.css({height:d.timeslotHeight*d.defaultEventLength}).show();var i=parseInt(g.css("top")),j=c._getEventDurationFromPositionedEventElement(f,g,i);g.remove();var k={start_time:j.start_time,end_time:j.end_time,entry_type:d.newEventText},l=d.showAsSeparateUsers&&d.users&&d.users.length;l?k=c._setEventUserId(k,f.data("wcUserId")):!d.showAsSeparateUsers&&d.users&&d.users.length==1&&(k=c._setEventUserId(k,c._getUserIdFromIndex(0)));var m=c.getFreeBusyManagerForEvent(k),n=c._renderEvent(k,f);d.allowCalEventOverlap?c._adjustOverlappingEvents(f):(c._adjustForEventCollisions(f,n,k,k),c._positionEvent(f,n));var o=c._trigger("beforeEventNew",b,{calEvent:k,createdFromSingleClick:h,calendar:c.element});o?d.eventNew(k,n,m,c.element,b):a(n).remove()}})},_loadCalEvents:function(d){var e,f,g,h,i=this,j=this.options;e=this._fixMinMaxDate(d||j.date),(!e||!e.getTime||!j.date||!j.date.getTime||e.getTime()!=j.date.getTime())&&this._trigger("changedate",this.element,e),this.options.date=e,f=i._dateFirstDayOfWeek(e),g=i._dateLastMilliOfWeek(e),j.calendarBeforeLoad(i.element),i.element.data("startDate",f),i.element.data("endDate",g),h=i.element.find(".wc-day-column-inner"),i._updateDayColumnHeader(h);if(typeof j.data=="string"){j.loading&&j.loading(!0),b&&(c?(b.onreadystatechange=null,b.abort(),b=null,j.loading&&j.loading(!1)):b.abort());var k=i._getJsonOptions();k[j.start_timeParam||"start"]=Math.round(f.getTime()/1e3),k[j.end_timeParam||"end"]=Math.round(g.getTime()/1e3),b=a.ajax({url:j.data,data:k,dataType:"json",error:function(a,b,c){c!="abort"&&a.status!=0&&alert("unable to get data, error:"+b)},success:function(a){i._renderEvents(a,h)},complete:function(){b=null,j.loading&&j.loading(!1)}})}else a.isFunction(j.data)?j.data(f,g,function(a){i._renderEvents(a,h)}):j.data&&i._renderEvents(j.data,h);i._disableTextSelect(h)},_updateDayColumnHeader:function(b){var c=this,d=this.options,f=c._cloneDate(c.element.data("startDate")),g=d.showAsSeparateUsers&&d.users&&d.users.length,h="ui-state-active wc-today";c.element.find(".wc-header td.wc-day-column-header").each(function(b,d){a(this).html(c._getHeaderDate(f)),c._isToday(f)||a(this).removeClass(h),f=c._addDays(f,1)}),f=c._cloneDate(c.element.data("startDate")),g&&c.element.find(".wc-header td.wc-user-header").each(function(b,e){c._isToday(f)?a(this).addClass(h):a(this).removeClass(h),f=(b+1)%d.users.length?f:c._addDays(f,1)}),f=c._cloneDate(c.element.data("startDate")),b.each(function(b,i){a(this).data("startDate",c._cloneDate(f)),a(this).data("endDate",new Date(f.getTime()+e)),c._isToday(f)?a(this).parent().addClass(h).removeClass("ui-state-default"):a(this).parent().removeClass(h).addClass("ui-state-default");if(!g||!((b+1)%d.users.length))f=c._addDays(f,1)}),d.displayFreeBusys&&(f=c._cloneDate(c.element.data("startDate")),c.element.find(".wc-grid-row-freebusy .wc-column-freebusy").each(function(b,h){a(this).data("startDate",c._cloneDate(f)),a(this).data("endDate",new Date(f.getTime()+e));if(!g||!((b+1)%d.users.length))f=c._addDays(f,1)}));if(this.options.title&&this.options.title.length){var i=this.options.date,j=c._cloneDate(c.element.data("startDate")),k=c._dateLastDayOfWeek(new Date(this._cloneDate(c.element.data("endDate")).getTime()-e)),l=this._getCalendarTitle();l=l.split("%start%").join(c._formatDate(j,d.dateFormat)),l=l.split("%end%").join(c._formatDate(k,d.dateFormat)),l=l.split("%date%").join(c._formatDate(i,d.dateFormat)),a(".wc-toolbar .wc-title",c.element).html(l)}},_getCalendarTitle:function(){return a.isFunction(this.options.title)?this.options.title(this.options.daysToShow):this.options.title},_renderEvents:function(b,c){var d=this,e=this.options,f;if(b.options){var g=!1;a.each(b.options,function(b,c){c!==e[b]&&(e[b]=c,g=g||a.ui.weekCalendar.updateLayoutOptions[b])}),d._computeOptions();if(g){var h=d._getCurrentScrollHour();d.element.empty(),d._renderCalendar(),c=d.element.find(".wc-time-slots .wc-day-column-inner"),d._updateDayColumnHeader(c),d._resizeCalendar(),d._scrollToHour(h,!1)}}this._clearCalendar(),a.isArray(b)?f=d._cleanEvents(b):b.events&&(f=d._cleanEvents(b.events),d._renderFreeBusys(b)),a.each(f,function(a,b){var e=new Date(b.start_time),f=new Date(b.end_time),g=d.options.businessHours.limitDisplay?d.options.businessHours.end_time:24,h=d.options.businessHours.limitDisplay?d.options.businessHours.start_time:0,i=new Date(e),j=d._formatDate(i,"Ymd"),k=d._formatDate(f,"Ymd"),l,m=!1;while(j<k)b.start_time=i,b.end_time.setFullYear(i.getFullYear()),b.end_time.setDate(i.getDate()),b.end_time.setMonth(i.getMonth()),b.end_time.setHours(g),b.end_time.setMinutes(0),b.end_time.setSeconds(0),(l=d._findWeekDayForEvent(b,c))&&d._renderEvent(b,l),i.setDate(i.getDate()+1),i.setHours(h),i.setMinutes(0),i.setSeconds(0),j=d._formatDate(i,"Ymd"),m=!0;i<=f&&(b.start_time=i,b.end_time=f,(m&&b.start_time.getTime()!=b.end_time.getTime()||!m)&&(l=d._findWeekDayForEvent(b,c))&&d._renderEvent(b,l)),b.start_time=e}),c.each(function(){d._adjustOverlappingEvents(a(this))}),e.calendarAfterLoad(d.element),f.length||e.noEvents()},_renderEvent:function(b,c){var d=this,e=this.options;if(b.start_time.getTime()>b.end_time.getTime())return;var f,g,h,i;return f=b.id?"wc-cal-event":"wc-cal-event wc-new-cal-event",g='<div class="'+f+' ui-corner-all">',g+='<div class="wc-time ui-corner-top"></div>',g+='<div class="wc-title"></div></div>',c.each(function(){var c=a(g);i=e.eventRender(b,c),c=i?i.appendTo(a(this)):c.appendTo(a(this)),c.css({lineHeight:e.textSize+2+"px",fontSize:e.textSize+"px"}),d._refreshEventDetails(b,c),d._positionEvent(a(this),c),h?h=h.add(c):h=c}),h.show(),!e.readonly&&e.resizable(b,h)&&d._addResizableToCalEvent(b,h,c),!e.readonly&&e.draggable(b,h)&&d._addDraggableToCalEvent(b,h),e.eventAfterRender(b,h),h},addEvent:function(){return alert("a"),this._renderEvent.apply(this,arguments)},_adjustOverlappingEvents:function(b){var c=this;if(c.options.allowCalEventOverlap){var d=c._groupOverlappingEventElements(b);a.each(d,function(){var b=this;a.each(b,function(d){var e=this;if(c.options.overlapEventsSeparate)var f=c.options.totalEventsWidthPercentInOneColumn/b.length,g=d*f;else var f=c.options.totalEventsWidthPercentInOneColumn-(b.length-1)*10,g=d*10;a.each(e,function(){c.options.overlapEventsSeparate||a(this).bind("mouseover.z-index",function(){var b=a(this);a.each(e,function(){a(this).css({"z-index":"1"})}),b.css({"z-index":"3"})}),a(this).css({width:f+"%",left:g+"%",right:0})})})})}},_groupOverlappingEventElements:function(b){var c=b.find(".wc-cal-event:visible"),d=c.sort(function(b,c){return a(b).data("calEvent").start_time.getTime()-a(c).data("calEvent").start_time.getTime()}),e=new Date(0,0,0),f=[],g=[],h;return a.each(d,function(){h=a(this),g.length>0&&e.getTime()<=h.data("calEvent").start_time.getTime()&&(f.push(g),g=[]);for(var b=0;b<g.length;b++)if(g[b].length>0&&g[b][g[b].length-1].data("calEvent").end_time.getTime()<=h.data("calEvent").start_time.getTime()){g[b].push(h),e.getTime()<h.data("calEvent").end_time.getTime()&&(e=h.data("calEvent").end_time);return}g.push([h]),e.getTime()<h.data("calEvent").end_time.getTime()&&(e=h.data("calEvent").end_time)}),g.length>0&&f.push(g),f},_findWeekDayForEvent:function(b,c){var d,e=this.options,f=e.showAsSeparateUsers&&e.users&&e.users.length,g=this._getEventUserId(b);return a.isArray(g)||(g=[g]),c.each(function(c,e){a(this).data("startDate").getTime()<=b.start_time.getTime()&&a(this).data("endDate").getTime()>=b.end_time.getTime()&&(!f||a.inArray(a(this).data("wcUserId"),g)!==-1)&&(d?d=d.add(a(e)):d=a(e))}),d},_updateEventInCalendar:function(b){var c=this;c._cleanEvent(b),b.id&&c.element.find(".wc-cal-event").each(function(){(a(this).data("calEvent").id===b.id||a(this).hasClass("wc-new-cal-event"))&&a(this).remove()});var d=c._findWeekDayForEvent(b,c.element.find(".wc-grid-row-events .wc-day-column-inner"));d&&d.each(function(d,e){var f=a(e),g=c._renderEvent(b,f);c._adjustForEventCollisions(f,g,b,b),c._refreshEventDetails(b,g),c._positionEvent(f,g),c._adjustOverlappingEvents(f)})},_positionEvent:function(a,b){var c=this.options,d=b.data("calEvent"),e=a.height()/c.millisToDisplay,f=c.businessHours.limitDisplay?c.businessHours.start_time:0,g=this._getDSTdayShift(d.start_time).getTime()-this._getDSTdayShift(new Date(d.start_time.getFullYear(),d.start_time.getMonth(),d.start_time.getDate(),f)).getTime(),h=this._getDSTdayShift(d.end_time).getTime()-this._getDSTdayShift(d.start_time).getTime(),i=e*g,j=e*h;b.css({top:i,height:j||e*36e5/c.timeslotsPerHour})},_getEventDurationFromPositionedEventElement:function(a,b,c){var d=this.options,e=d.businessHours.limitDisplay?d.businessHours.start_time*36e5:0,f=new Date(a.data("startDate").getTime()+e+Math.round(c/d.timeslotHeight)*d.millisPerTimeslot),g=new Date(f.getTime()+b.height()/d.timeslotHeight*d.millisPerTimeslot);return{start_time:this._getDSTdayShift(f,-1),end_time:this._getDSTdayShift(g,-1)}},_adjustForEventCollisions:function(b,c,d,e,f){var g=this.options;if(g.allowCalEventOverlap)return;var h,i,j=this;b.find(".wc-cal-event").not(c).each(function(){var b=a(this).data("calEvent");d.start_time.getTime()<b.end_time.getTime()&&d.end_time.getTime()>=b.end_time.getTime()&&(h=b.end_time),d.end_time.getTime()>b.start_time.getTime()&&d.start_time.getTime()<=b.start_time.getTime()&&(i=b.start_time);if(e.resizable==0||d.end_time.getTime()<=b.end_time.getTime()&&d.start_time.getTime()>=b.start_time.getTime())return h=e.start_time,i=e.end_time,!1}),d.start_time=h||d.start_time,h&&f?(d.end_time=new Date(h.getTime()+(e.end_time.getTime()-e.start_time.getTime())),j._adjustForEventCollisions(b,c,d,e)):d.end_time=i||d.end_time,d.start_time.getTime()>=d.end_time.getTime()&&(d.start_time=e.start_time,d.end_time=e.end_time),c.data("calEvent",d)},_addDraggableToCalEvent:function(a,b){var c=this.options;b.draggable({handle:".wc-time",containment:"div.wc-time-slots",snap:".wc-day-column-inner",snapMode:"inner",snapTolerance:c.timeslotHeight-1,revert:"invalid",opacity:.5,grid:[b.outerWidth()+1,c.timeslotHeight],start:function(b,d){var e=d.draggable;c.eventDrag(a,e)}})},_addDroppableToWeekDay:function(b){var c=this,d=this.options;b.droppable({accept:".wc-cal-event",drop:function(e,f){var g=f.draggable,h=Math.round(parseInt(f.position.top)),i=c._getEventDurationFromPositionedEventElement(b,g,h),j=g.data("calEvent"),k=a.extend(!0,{},j,{start_time:i.start_time,end_time:i.end_time}),l=d.showAsSeparateUsers&&d.users&&d.users.length;if(l){var m=b.data("wcUserId"),n=c._getEventUserId(j),o=a(f.draggable.parents(".wc-day-column-inner").get(0)).data("wcUserId");a.isArray(n)||(n=[n]);if(a.inArray(m,n)==-1){var p=a.inArray(o,n);n.splice(p,1),a.inArray(m,n)==-1&&n.push(m)}k=c._setEventUserId(k,n.length==1?n[0]:n)}c._adjustForEventCollisions(b,g,k,j,!0);var q=c.element.find(".wc-day-column-inner");d.eventDrop(k,j,g);var r=c._renderEvent(k,c._findWeekDayForEvent(k,q));g.hide(),g.data("preventClick",!0);var s=c._findWeekDayForEvent(g.data("calEvent"),c.element.find(".wc-time-slots .wc-day-column-inner"));s.data("startDate")!=b.data("startDate")&&c._adjustOverlappingEvents(s),c._adjustOverlappingEvents(b),setTimeout(function(){g.remove()},1e3)}})},_addResizableToCalEvent:function(b,c,d){var e=this,f=this.options;c.resizable({grid:f.timeslotHeight,containment:d,handles:"s",minHeight:f.timeslotHeight,stop:function(c,g){var h=g.element,i=new Date(h.data("calEvent").start_time.getTime()+Math.max(1,Math.round(g.size.height/f.timeslotHeight))*f.millisPerTimeslot);e._needDSTdayShift(h.data("calEvent").start_time,i)&&(i=e._getDSTdayShift(i,-1));var j=a.extend(!0,{},b,{start_time:b.start_time,end_time:i});e._adjustForEventCollisions(d,h,j,b),e._refreshEventDetails(j,h),e._positionEvent(d,h),e._adjustOverlappingEvents(d),f.eventResize(j,b,h),h.data("preventClick",!0),setTimeout(function(){h.removeData("preventClick")},500)}}),a(".ui-resizable-handle",c).text("=")},_refreshEventDetails:function(a,b){var c="";!this.options.readonly&&this.options.allowEventDelete&&this.options.deletable(a,b)&&(c='<div class="wc-cal-event-delete ui-icon ui-icon-close"></div>'),b.find(".wc-time").html(this.options.eventHeader(a,this.element)+c),b.find(".wc-title").html(this.options.eventBody(a,this.element)),b.data("calEvent",a),this.options.eventRefresh(a,b)},_clearCalendar:function(){this.element.find(".wc-day-column-inner div").remove(),this._clearFreeBusys()},_scrollToHour:function(a,b){var c=this,d=this.options,e=this.element.find(".wc-scrollable-grid"),f=a;c.options.businessHours.limitDisplay&&(a<=c.options.businessHours.start_time?f=0:a>=c.options.businessHours.end_time?f=c.options.businessHours.end_time-c.options.businessHours.start_time-1:f=a-c.options.businessHours.start_time);var g=this.element.find(".wc-grid-timeslot-header .wc-hour-header:eq("+f+")");e.animate({scrollTop:0},0,function(){var a=g.offset().top,c=a-e.offset().top-g.outerHeight();b?e.animate({scrollTop:c},d.scrollToHourMillis):e.animate({scrollTop:c},0)})},_hourForIndex:function(a){return a=(a+2)%24,a===0?12:a<13?a:a-12},_24HourForIndex:function(a){return a=(a+2)%24,a===0?"00:00":a<10?"0"+a+":00":a+":00"},_amOrPm:function(a){return a=(a+2)%24,a<12?"AM":"PM"},_isToday:function(a){var b=this._cloneDate(a);this._clearTime(b);var c=new Date;return this._clearTime(c),c.getTime()===b.getTime()},_cleanEvents:function(b){var c=this;return a.each(b,function(a,b){c._cleanEvent(b)}),b},_cleanEvent:function(a){a.date&&(a.start_time=a.date),a.start_time=this._cleanDate(a.start_time),a.end_time=this._cleanDate(a.end_time),a.end_time||(a.end_time=this._addDays(this._cloneDate(a.start_time),1))},_disableTextSelect:function(b){b.each(function(){a.browser.mozilla?a(this).css("MozUserSelect","none"):a.browser.msie?a(this).bind("selectstart",function(){return!1}):a(this).mousedown(function(){return!1})})},_dateFirstDayOfWeek:function(a){var b=this,c=new Date(a.getFullYear(),a.getMonth(),a.getDate()),d=new Date(c);return d.setDate(d.getDate()-b._getAdjustedDayIndex(c)),d},_dateLastDayOfWeek:function(a){var b=this,c=new Date(a.getFullYear(),a.getMonth(),a.getDate()),d=new Date(c),e=b.options.daysToShow-1-b._getAdjustedDayIndex(c);return d.setDate(d.getDate()+e),d},_fixMinMaxDate:function(a){var b,c;a=this._cleanDate(a),this.options.minDate&&(b=this._cleanDate(this.options.minDate),b=new Date(b.getFullYear(),b.getMonth(),b.getDate()),a.getTime()<b.getTime()&&this._trigger("reachedmindate",this.element,a),a=this._cleanDate(Math.max(a.getTime(),b.getTime())));if(this.options.maxDate){c=this._cleanDate(this.options.maxDate);if(!this._startOnFirstDayOfWeek()){var d=c.getDate()-this.options.daysToShow+1;c=new Date(c.getFullYear(),c.getMonth(),d)}c=new Date(c.getFullYear(),c.getMonth(),c.getDate(),23,59,59,999),a.getTime()>c.getTime()&&this._trigger("reachedmaxdate",this.element,a),a=this._cleanDate(Math.min(a.getTime(),c.getTime()))}return a},_getAdjustedDayIndex:function(a){if(!this._startOnFirstDayOfWeek())return 0;var b=new Date(a.getFullYear(),a.getMonth(),a.getDate()),c=b.getDay(),d=[0,1,2,3,4,5,6];return this._rotate(d,this._firstDayOfWeek()),d[c]},_firstDayOfWeek:function(){return a.isFunction(this.options.firstDayOfWeek)?this.options.firstDayOfWeek(this.element):this.options.firstDayOfWeek},_dateLastMilliOfWeek:function(a){var b=this._dateLastDayOfWeek(a);return b=this._cloneDate(b),b.setDate(b.getDate()+1),b},
_clearTime:function(a){return a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0),a},_addDays:function(a,b,c){return a.setDate(a.getDate()+b),c?a:this._clearTime(a)},_rotate:function(a,b){for(var c=a.length,b=(Math.abs(b)>=c&&(b%=c),b<0&&(b+=c),b),d,e;b;b=(Math.ceil(c/b)-1)*b-c+(c=b))for(d=c;d>b;e=a[--d],a[d]=a[d-b],a[d-b]=e);return a},_cloneDate:function(a){return new Date(a.getTime())},_cleanDate:function(a){return typeof a=="string"?!isNaN(parseFloat(a))&&isFinite()?this._cleanDate(parseInt(a,10)):Date.parse(a)||new Date(a):typeof a=="number"?new Date(a):a},_formatDate:function(a,b){a=new Date(a.getTime()+d);var c="";for(var e=0;e<b.length;e++){var f=b.charAt(e);e!=0&&b.charAt(e-1)=="\\"?c+=f:this._replaceChars[f]?c+=this._replaceChars[f](a,this):f!="\\"&&(c+=f)}return c},_replaceChars:{d:function(a){return(a.getDate()<10?"0":"")+a.getDate()},D:function(a,b){return b.options.shortDays[a.getDay()]},j:function(a){return a.getDate()},l:function(a,b){return b.options.longDays[a.getDay()]},N:function(a){var b=a.getDay();return b?b:7},S:function(a){return a.getDate()%10==1&&a.getDate()!=11?"st":a.getDate()%10==2&&a.getDate()!=12?"nd":a.getDate()%10==3&&a.getDate()!=13?"rd":"th"},w:function(a){return a.getDay()},z:function(a){var b=new Date(a.getFullYear(),0,1);return Math.ceil((a-b)/864e5)},W:function(a){var b=new Date(a.getFullYear(),0,1);return Math.ceil(((a-b)/864e5+b.getDay()+1)/7)},F:function(a,b){return b.options.longMonths[a.getMonth()]},m:function(a){return(a.getMonth()<9?"0":"")+(a.getMonth()+1)},M:function(a,b){return b.options.shortMonths[a.getMonth()]},n:function(a){return a.getMonth()+1},t:function(a){var b=a;return(new Date(b.getFullYear(),b.getMonth()+1,0)).getDate()},L:function(a){var b=a.getFullYear();return b%400==0||b%100!=0&&b%4==0},o:function(a){var b=new Date(a.valueOf());return b.setDate(b.getDate()-(a.getDay()+6)%7+3),b.getFullYear()},Y:function(a){return a.getFullYear()},y:function(a){return(""+a.getFullYear()).substr(2)},a:function(a){return a.getHours()<12?"am":"pm"},A:function(a){return a.getHours()<12?"AM":"PM"},B:function(a){return Math.floor(((a.getUTCHours()+1)%24+a.getUTCMinutes()/60+a.getUTCSeconds()/3600)*1e3/24)},g:function(a){return a.getHours()%12||12},G:function(a){return a.getHours()},h:function(a){return((a.getHours()%12||12)<10?"0":"")+(a.getHours()%12||12)},H:function(a){return(a.getHours()<10?"0":"")+a.getHours()},i:function(a){return(a.getMinutes()<10?"0":"")+a.getMinutes()},s:function(a){return(a.getSeconds()<10?"0":"")+a.getSeconds()},u:function(a){var b=a.getMilliseconds();return(b<10?"00":b<100?"0":"")+b},e:function(a){return"Not Yet Supported"},I:function(a){return"Not Yet Supported"},O:function(a){return(-a.getTimezoneOffset()<0?"-":"+")+(Math.abs(a.getTimezoneOffset()/60)<10?"0":"")+Math.abs(a.getTimezoneOffset()/60)+"00"},P:function(a){return(-a.getTimezoneOffset()<0?"-":"+")+(Math.abs(a.getTimezoneOffset()/60)<10?"0":"")+Math.abs(a.getTimezoneOffset()/60)+":00"},T:function(a){var b=a.getMonth();a.setMonth(0);var c=a.toTimeString().replace(/^.+ \(?([^\)]+)\)?$/,"$1");return a.setMonth(b),c},Z:function(a){return-a.getTimezoneOffset()*60},c:function(a,b){return b._formatDate(a,"Y-m-d\\TH:i:sP")},r:function(a,b){return b._formatDate(a,"D, d M Y H:i:s O")},U:function(a){return a.getTime()/1e3}},getUserForId:function(b){return a.extend({},this.options.users[this._getUserIndexFromId(b)])},_getUserName:function(b){var c=this,d=this.options,e=d.users[b];return a.isFunction(d.getUserName)?d.getUserName(e,b,c.element):e},_getUserIdFromIndex:function(b){var c=this,d=this.options;return a.isFunction(d.getUserId)?d.getUserId(d.users[b],b,c.element):b},_getUserIndexFromId:function(a){var b=this,c=this.options;for(var d=0;d<c.users.length;d++)if(b._getUserIdFromIndex(d)==a)return d;return 0},_getEventUserId:function(b){var c=this,d=this.options;return d.showAsSeparateUsers&&d.users&&d.users.length?a.isFunction(d.getEventUserId)?d.getEventUserId(b,c.element):b.userId:[]},_setEventUserId:function(b,c){var d=this,e=this.options;return a.isFunction(e.setEventUserId)?e.setEventUserId(c,b,d.element):(b.userId=c,b)},_getFreeBusyUserId:function(b){var c=this,d=this.options;return a.isFunction(d.getFreeBusyUserId)?d.getFreeBusyUserId(b.getOption(),c.element):b.getOption("userId")},_clearFreeBusys:function(){if(this.options.displayFreeBusys){var b=this,c=this.options,d=b.element.find(".wc-grid-row-freebusy .wc-column-freebusy");d.each(function(){a(this).data("wcFreeBusyManager",new j({start_time:b._cloneDate(a(this).data("startDate")),end_time:b._cloneDate(a(this).data("endDate")),defaultFreeBusy:c.defaultFreeBusy||{}}))}),b.element.find(".wc-grid-row-freebusy .wc-freebusy").remove()}},_findWeekDaysForFreeBusy:function(b,c){var d,e=this.options,f=e.showAsSeparateUsers&&e.users&&e.users.length,g=this,h=g._getFreeBusyUserId(b);return a.isArray(h)||(h=h!="undefined"?[h]:[]),c||(c=g.element.find(".wc-grid-row-freebusy .wc-column-freebusy")),c.each(function(){var c=a(this).data("wcFreeBusyManager"),e=c.isWithin(b.getStart())||c.isWithin(b.getEnd())||b.isWithin(c.getStart())||b.isWithin(c.getEnd()),g=a(this).data("wcUserId");e&&(!f||a.inArray(g,h)!=-1)&&(d=d?d.add(a(this)):a(this))}),d},_renderFreeBusys:function(b){if(this.options.displayFreeBusys){var c=this,d=c.element.find(".wc-grid-row-freebusy .wc-column-freebusy"),e;a.isArray(b)?e=c._cleanFreeBusys(b):b.freebusys?e=c._cleanFreeBusys(b.freebusys):e=[],a.each(e,function(b,e){var f=c._findWeekDaysForFreeBusy(e,d);f&&f.each(function(){var b=a(this).data("wcFreeBusyManager");b.insertFreeBusy(new h(e.getOption())),a(this).data("wcFreeBusyManager",b)})}),c._refreshFreeBusys(d)}},_refreshFreeBusys:function(b){if(this.options.displayFreeBusys&&b){var c=this,d=this.options,e=d.businessHours.limitDisplay?d.businessHours.start_time:0,f=d.businessHours.limitDisplay?d.businessHours.end_time:24;b.each(function(){var b=a(this),d=c._cloneDate(b.data("startDate")),g=c._cloneDate(d);d.setHours(e),g.setHours(f),b.find(".wc-freebusy").remove(),a.each(b.data("wcFreeBusyManager").getFreeBusys(d,g),function(){c._renderFreeBusy(this,b)})})}},_renderFreeBusy:function(b,c){if(this.options.displayFreeBusys){var d=this,e=this.options,f='<div class="wc-freebusy"></div>',g=a(f);g.data("wcFreeBusy",new h(b.getOption())),this._positionFreeBusy(c,g),g=e.freeBusyRender(b.getOption(),g,d.element),g&&g.appendTo(c)}},_positionFreeBusy:function(a,b){var c=this.options,d=b.data("wcFreeBusy"),e=a.height()/c.millisToDisplay,f=c.businessHours.limitDisplay?c.businessHours.start_time:0,g=d.getStart().getTime()-(new Date(d.getStart().getFullYear(),d.getStart().getMonth(),d.getStart().getDate(),f)).getTime(),h=d.getEnd().getTime()-d.getStart().getTime(),i=e*g,j=e*h;b.css({top:i,height:j})},_cleanFreeBusys:function(b){var c=this,d=[];if(!a.isArray(b))var b=[b];return a.each(b,function(a,b){d.push(new h(c._cleanFreeBusy(b)))}),d},_cleanFreeBusy:function(a){return a.date&&(a.start_time=a.date),a.start_time=this._cleanDate(a.start_time),a.end_time=this._cleanDate(a.end_time),a},getFreeBusyManagersFor:function(a,b){var c={start_time:a,end_time:a};return this._setEventUserId(c,b),this.getFreeBusyManagerForEvent(c)},getFreeBusyManagerForEvent:function(b){var c=this,d=this.options,e;if(d.displayFreeBusys){var f=c.element.find(".wc-grid-row-freebusy .wc-column-freebusy"),g=new h({start_time:b.start_time,end_time:b.end_time}),i=d.showAsSeparateUsers&&d.users&&d.users.length,j=i?c._getEventUserId(b):null;a.isArray(j)||(j=[j]),f.each(function(){var b=a(this).data("wcFreeBusyManager"),c=b.isWithin(g.getEnd())||b.isWithin(g.getEnd())||g.isWithin(b.getStart())||g.isWithin(b.getEnd());if(c&&(!i||a.inArray(a(this).data("wcUserId"),j)!=-1))return e=a(this).data("wcFreeBusyManager"),!1})}return e},updateFreeBusy:function(b){var c=this,d=this.options;if(d.displayFreeBusys){var e,f=c.element.find(".wc-grid-row-freebusy .wc-column-freebusy"),g=c._cleanFreeBusys(b);a.each(g,function(b,d){var g=c._findWeekDaysForFreeBusy(d,f);g&&g.length&&(g.each(function(b,c){var e=a(c).data("wcFreeBusyManager");e.insertFreeBusy(d),a(c).data("wcFreeBusyManager",e)}),e=e?e.add(g):g)}),c._refreshFreeBusys(e)}},_startOnFirstDayOfWeek:function(){return jQuery.isFunction(this.options.startOnFirstDayOfWeek)?this.options.startOnFirstDayOfWeek(this.element):this.options.startOnFirstDayOfWeek},_getCurrentScrollHour:function(){var a=this,b=this.options,c=this.element.find(".wc-scrollable-grid"),d=c.scrollTop();return a.options.businessHours.limitDisplay&&(d+=b.businessHours.start_time*b.timeslotHeight*b.timeslotsPerHour),Math.round(d/(b.timeslotHeight*b.timeslotsPerHour))+1},_getJsonOptions:function(){return a.isFunction(this.options.jsonOptions)?a.extend({},this.options.jsonOptions(this.element)):a.isPlainObject(this.options.jsonOptions)?a.extend({},this.options.jsonOptions):{}},_getHeaderDate:function(b){var c=this.options;if(c.getHeaderDate&&a.isFunction(c.getHeaderDate))return c.getHeaderDate(b,this.element);var d=c.useShortDayNames?c.shortDays[b.getDay()]:c.longDays[b.getDay()];return d},_getDSTdayShift:function(a,b){var c=new Date(a.getFullYear(),a.getMonth(),a.getDate(),0),d=c.getTimezoneOffset(),e=a.getTimezoneOffset();return d==e?a:(b=b?b:1,new Date(a.getTime()-b*(d>e?-1:1)*(Math.max(d,e)-Math.min(d,e))*6e4))},_needDSTdayShift:function(a,b){return a.getTimezoneOffset()!=b.getTimezoneOffset()}}}()),a.extend(a.ui.weekCalendar,{version:"2.0-dev",updateLayoutOptions:{startOnFirstDayOfWeek:!0,firstDayOfWeek:!0,daysToShow:!0,displayOddEven:!0,timeFormat:!0,dateFormat:!0,use24Hour:!0,useShortDayNames:!0,businessHours:!0,timeslotHeight:!0,timeslotsPerHour:!0,buttonText:!0,height:!0,shortMonths:!0,longMonths:!0,shortDays:!0,longDays:!0,textSize:!0,users:!0,showAsSeparateUsers:!0,displayFreeBusys:!0}});var d=72e5,e=864e5,f=e*7,g={getStart:function(){return this.getOption("start")},getEnd:function(){return this.getOption("end")},getOption:function(){return arguments.length?typeof this.options[arguments[0]]!="undefined"?this.options[arguments[0]]:typeof arguments[1]!="undefined"?arguments[1]:null:this.options},setOption:function(b,c){return arguments.length==1?(a.extend(this.options,arguments[0]),this):(this.options[b]=c,this)},isWithin:function(a){return Math.floor(a.getTime()/1e3)>=Math.floor(this.getStart().getTime()/1e3)&&Math.floor(a.getTime()/1e3)<=Math.floor(this.getEnd().getTime()/1e3)},isValid:function(){return this.getStart().getTime()<this.getEnd().getTime()}},h=function(b){this.options=a.extend({},b||{})};a.extend(h.prototype,g);var j=function(b){this.options=a.extend({defaultFreeBusy:{}},b||{}),this.freeBusys=[],this.freeBusys.push(new h(a.extend({start:this.getStart(),end:this.getEnd()},this.options.defaultFreeBusy)))};a.extend(j.prototype,g,{getFreeBusys:function(){switch(arguments.length){case 0:return this.freeBusys;case 1:var b=[],c=arguments[0];if(!this.isWithin(c))return b;return a.each(this.freeBusys,function(){this.isWithin(c)&&b.push(this);if(Math.floor(this.getEnd().getTime()/1e3)>Math.floor(c.getTime()/1e3))return!1}),b;default:var b=[],c=arguments[0],d=arguments[1],e=new h({start:c,end:d});if(d.getTime()<c.getTime()||this.getStart().getTime()>d.getTime()||this.getEnd().getTime()<c.getTime())return b;return a.each(this.freeBusys,function(){if(this.getStart().getTime()>=d.getTime())return!1;if(e.isWithin(this.getStart())&&e.isWithin(this.getEnd()))b.push(this);else if(this.isWithin(e.getStart())&&this.isWithin(e.getEnd())){var a=new h(this.getOption());a.setOption("end",e.getEnd()),a.setOption("start",e.getStart()),b.push(a)}else if(this.isWithin(e.getStart())&&this.getStart().getTime()<c.getTime()){var a=new h(this.getOption());a.setOption("start",e.getStart()),b.push(a)}else if(this.isWithin(e.getEnd())&&this.getEnd().getTime()>d.getTime()){var a=new h(this.getOption());a.setOption("end",e.getEnd()),b.push(a)}}),b}},insertFreeBusy:function(b){var b=new h(b.getOption());b.getStart().getTime()<this.getStart().getTime()&&b.setOption("start",this.getStart()),b.getEnd().getTime()>this.getEnd().getTime()&&b.setOption("end",this.getEnd());var c=b.getStart(),d=b.getEnd(),e=0,f=this.freeBusys.length-1,g=[],i=function(a){a.isValid()&&g.push(a)};a.each(this.freeBusys,function(a){var g=this;if(g.isWithin(c)&&g.isWithin(d)){e=a,f=a;if(c.getTime()==g.getStart().getTime()&&d.getTime()==g.getEnd().getTime()){var j=new h(b.getOption());i(j)}else if(c.getTime()==g.getStart().getTime()){var j=new h(b.getOption()),k=new h(g.getOption());k.setOption("start",d),i(j),i(k)}else if(d.getTime()==g.getEnd().getTime()){var j=new h(g.getOption());j.setOption("end",c);var k=new h(b.getOption());i(j),i(k)}else{var j=new h(g.getOption()),k=new h(b.getOption()),l=new h(g.getOption());j.setOption("end",c),l.setOption("start",d),i(j),i(k),i(l)}return!1}if(g.isWithin(c)&&g.getEnd().getTime()!=c.getTime()){if(g.getStart().getTime()!=c.getTime()){var j=new h(g.getOption());j.setOption("end",c),i(j)}e=a}else if(g.isWithin(d)&&g.getStart().getTime()!=d.getTime()){i(new h(b.getOption()));if(d.getTime()<g.getEnd().getTime()){var j=new h(g.getOption());j.setOption("start",d),i(j)}return f=a,!1}});var j=this.freeBusys;return this.freeBusys=[],e&&(this.freeBusys=this.freeBusys.concat(j.slice(0,e))),this.freeBusys=this.freeBusys.concat(g),f<j.length&&(this.freeBusys=this.freeBusys.concat(j.slice(f+1))),this}})})(jQuery);